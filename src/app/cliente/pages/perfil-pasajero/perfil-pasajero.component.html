<div class="perfil-wrapper">
  <div class="perfil-card" *ngIf="!loading; else loadingTpl">

    <!-- CABECERA -->
    <div class="perfil-header">
      <div class="avatar-circle">
        <span>{{ form.get('nombres')?.value?.charAt(0) || 'U' }}</span>
      </div>

      <div class="perfil-header-text">
        <h2>Mi perfil</h2>
        <p>Gestiona y actualiza tus datos personales</p>
      </div>

      <div class="perfil-actions">
        <!-- BOTÓN EDITAR -->
        <button
          *ngIf="!editMode"
          type="button"
          class="btn-outline"
          (click)="activarEdicion()">
          ✏️ Editar perfil
        </button>

        <!-- BOTONES GUARDAR / CANCELAR -->
        <ng-container *ngIf="editMode">
          <button
            type="button"
            class="btn-secondary"
            (click)="cancelarEdicion()"
            [disabled]="loading">
            Cancelar
          </button>
          <button
            type="button"
            class="btn-primary"
            (click)="guardarCambios()"
            [disabled]="loading">
            Guardar cambios
          </button>
        </ng-container>
      </div>
    </div>

    <!-- MENSAJES -->
    <div *ngIf="errorMessage" class="alert alert-error">
      {{ errorMessage }}
    </div>
    <div *ngIf="successMessage" class="alert alert-success">
      {{ successMessage }}
    </div>

    <!-- FORMULARIO -->
    <form [formGroup]="form" class="perfil-form">
      <div class="form-row">
        <div class="form-group">
          <label>Nombres</label>
          <input type="text" formControlName="nombres" />
        </div>

        <div class="form-group">
          <label>Apellidos</label>
          <input type="text" formControlName="apellidos" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>DNI</label>
          <input type="text" formControlName="dni" />
        </div>

        <div class="form-group">
          <label>Correo electrónico</label>
          <input type="email" formControlName="email" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Celular</label>
          <input type="text" formControlName="telefono" />
        </div>
      </div>

      <!-- BOTONES ABAJO (útil en móvil) -->
      <div class="perfil-actions bottom" *ngIf="editMode">
        <button
          type="button"
          class="btn-secondary"
          (click)="cancelarEdicion()"
          [disabled]="loading">
          Cancelar
        </button>
        <button
          type="button"
          class="btn-primary"
          (click)="guardarCambios()"
          [disabled]="loading">
          Guardar cambios
        </button>
      </div>
    </form>
  </div>

  <ng-template #loadingTpl>
    <div class="perfil-loading">
      Cargando tu perfil...
    </div>
  </ng-template>
</div>
