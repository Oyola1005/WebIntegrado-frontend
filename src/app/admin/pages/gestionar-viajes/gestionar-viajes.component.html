<!-- src/app/admin/pages/gestionar-viajes/gestionar-viajes.component.html -->
<div class="admin-wrapper container-fluid py-4">

  <div class="row mb-3">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <h2 class="page-title">Gestión de viajes</h2>
      <button class="btn btn-outline-light btn-sm shadow-sm" (click)="nuevoViaje()">
        + Nuevo viaje
      </button>
    </div>
  </div>

  <!-- Mensajes -->
  <div *ngIf="loading" class="alert alert-info">Procesando...</div>
  <div *ngIf="errorMsg" class="alert alert-danger">{{ errorMsg }}</div>
  <div *ngIf="successMsg" class="alert alert-success">{{ successMsg }}</div>

  <div class="row g-4">

    <!-- LISTA DE VIAJES -->
    <div class="col-lg-8">
      <div class="card shadow-sm h-100">

        <div class="card-header d-flex justify-content-between align-items-center">
          <span class="fw-semibold">Viajes registrados</span>
          <span class="badge bg-primary">{{ viajes.length }} viajes</span>
        </div>

        <div class="table-responsive">
          <table class="table mb-0 align-middle">
            <thead class="table-light">
              <tr>
                <th>ID</th>
                <th>Ruta</th>
                <th>Salida</th>
                <th>Llegada</th>
                <th>Precio</th>
                <th>Asientos</th>
                <th>Estado</th>
                <th class="text-end">Acciones</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let v of viajes">
                <td>{{ v.id }}</td>

                <td>
                  <div class="fw-semibold">{{ v.origen }} → {{ v.destino }}</div>
                </td>

                <td>
                  <div class="small">
                    {{ v.fechaSalida | date:'shortDate' }}<br />
                    <span class="text-muted">{{ v.fechaSalida | date:'shortTime' }}</span>
                  </div>
                </td>

                <td>
                  <div class="small">
                    {{ v.fechaLlegada | date:'shortDate' }}<br />
                    <span class="text-muted">{{ v.fechaLlegada | date:'shortTime' }}</span>
                  </div>
                </td>

                <td>S/ {{ v.precio | number:'1.2-2' }}</td>
                <td>{{ v.asientosDisponibles }}</td>

                <td>
                  <span class="badge"
                        [ngClass]="{
                          'bg-success':   v.estado === 'PROGRAMADO',
                          'bg-warning text-dark': v.estado === 'RESERVADO',
                          'bg-secondary': v.estado === 'COMPLETADO',
                          'bg-danger':    v.estado === 'CANCELADO'
                        }">
                    {{ v.estado }}
                  </span>
                </td>

                <td class="text-end">
                  <button class="btn btn-sm btn-outline-primary me-1" (click)="editarViaje(v)">Editar</button>
                  <button class="btn btn-sm btn-outline-danger" (click)="eliminarViaje(v)">Eliminar</button>
                </td>
              </tr>

              <tr *ngIf="!viajes.length && !loading">
                <td colspan="8" class="text-center text-muted py-4">
                  No hay viajes registrados todavía.
                </td>
              </tr>

            </tbody>
          </table>
        </div>

      </div>
    </div>

    <!-- FORMULARIO (CREAR / EDITAR) -->
    <div class="col-lg-4">

      <div class="card shadow-sm">
        <div class="card-header">
          <span class="fw-semibold">
            {{ editando ? 'Editar viaje' : 'Nuevo viaje' }}
          </span>
        </div>

        <div class="card-body">

          <form [formGroup]="form" (ngSubmit)="guardarViaje()">

            <!-- ORIGEN -->
            <div class="mb-3">
              <label class="form-label">Origen</label>
              <select class="form-select" formControlName="origen">
                <option value="" disabled>Seleccionar origen</option>
                <option value="Lima">Lima</option>
                <option value="Chimbote">Chimbote</option>
              </select>
            </div>

            <!-- DESTINO -->
            <div class="mb-3">
              <label class="form-label">Destino</label>
              <select class="form-select" formControlName="destino">
                <option value="" disabled>Seleccionar destino</option>
                <option value="Lima">Lima</option>
                <option value="Chimbote">Chimbote</option>
              </select>
            </div>

            <!-- FECHA SALIDA -->
            <div class="mb-3">
              <label class="form-label">Fecha y hora de salida</label>
              <input
                type="datetime-local"
                class="form-control"
                formControlName="fechaSalida"
                [min]="minFechaSalida"
              />
            </div>

            <!-- FECHA LLEGADA -->
            <div class="mb-3">
              <label class="form-label">Fecha y hora de llegada</label>
              <input
                type="datetime-local"
                class="form-control"
                formControlName="fechaLlegada"
                [min]="minFechaSalida"
              />

              <!-- ERROR SOLO SI LA FECHA ES INVÁLIDA -->
              <div
                *ngIf="
                  f['fechaLlegada'].hasError('rangoFechasInvalido') &&
                  (f['fechaSalida'].touched || f['fechaLlegada'].touched)
                "
                class="form-text text-danger"
              >
                La fecha de llegada debe ser mayor a la fecha de salida.
              </div>
            </div>

            <!-- PRECIO Y ASIENTOS -->
            <div class="row g-2 mb-3">
              <div class="col-6">
                <label class="form-label">Precio (S/)</label>
                <input type="number" class="form-control" formControlName="precio" min="1" step="1" />
              </div>

              <div class="col-6">
                <label class="form-label">Asientos disponibles</label>
                <input type="number" class="form-control" formControlName="asientosDisponibles" min="1" step="1" />
              </div>
            </div>

            <!-- ESTADO -->
            <div class="mb-3">
              <label class="form-label">Estado</label>
              <select class="form-select" formControlName="estado">
                <option value="PROGRAMADO">PROGRAMADO</option>
                <option value="RESERVADO">RESERVADO</option>
                <option value="COMPLETADO">COMPLETADO</option>
                <option value="CANCELADO">CANCELADO</option>
              </select>
            </div>

            <!-- BOTONES -->
            <div class="d-flex justify-content-between">
              <button type="submit" class="btn btn-primary" [disabled]="loading">
                {{ editando ? 'Guardar cambios' : 'Crear viaje' }}
              </button>

              <button type="button" class="btn btn-outline-secondary" (click)="nuevoViaje()">
                Limpiar
              </button>
            </div>

          </form>

        </div>
      </div>

    </div>

  </div>

</div>
